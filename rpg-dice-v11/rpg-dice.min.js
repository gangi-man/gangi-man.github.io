function make_rpg_dice_counter(){function e(e){for(;e;){if("BLOCKQUOTE"==e.tagName)return e
e=e.nextElementSibling}return null}function r(e,r,n){var t=null,c=[]
if(r.innerHTML.split(/<br>/i).forEach(function(e,r,n){e.match(/<font\s+color="#ff0000"\s*>/i)&&(t=e,e=e.replace(/<font/i,'<span class="faces"><font'),e=e.replace(/<\/font>/i,"</font></span>")),c.push(e)}),t){r.innerHTML=c.join("<br>")
var i=RegExp(/dice(\d+)d(\d+)([-+]\d+)?=/i),o=i.exec(t)
if(!o)return null
var a=o[1],l=o[2],u=0,f=""
o[3]&&(u=Number(o[3]),u<0&&(f=""+u),u>0&&(f="+"+u))
var s="dice"+a+"d"+l+f,_=/<font\s+color="#ff0000">\s*((\d+\s+)+)\((\d+)\)<\/font>/.exec(t)
if(!_)return console.log("---------something wrong ---"+e+"\n"+t),null
var d=Number(_[3]),m=_[1].replace(/\s+$/,"").split(/\s+/)
return m.forEach(function(e,r,n){n[r]=Number(e)}),{dnum:a,dmax:l,dadd:u,kind:s,id:Number(e),input:n,bloq:r,faces:m,sum:d}}}function n(){var n=document.getElementsByTagName("input")
u=[]
for(var c=0;c<n.length;c++){var i=/delcheck(\d+)/.exec(n[c].getAttribute("id"))
if(i){var o=e(n[c])
if(o){var a=r(i[1],o,n[c]),l=t(o)
!_rule&&l&&(_rule=l),a&&u.push(a)}}}_rule||(_rule={})}function t(e){function r(e,r,t){var c=" ";/;$/.exec(e)&&(c="<br>"),e=e.replace(/[;,]$/,"")
var i=/#(\d+)/,o=i.exec(e),a=Number(o[1]),l=/\d+:[^\s]*/g,u=e.match(l),f={}
if(u)for(var r=0;r<u.length;r++){var s=u[r].split(":")
f[Number(s[0])]=s[1]}e=e.replace(i,""),e=e.replace(l,""),e=e.replace(/^\s*/,"")
var _={face_rule:null}
_.name=e.replace(/\s*$/,""),_.delimiter=c,Object.keys(f).length>0&&(_.face_rule=f),n[a]=_}var n={},t=0
return e.innerHTML.split(/<br>/).forEach(function(e,n,c){if(!e.match(/<font/)){var i=RegExp(/#\d+\s*[^;,]*[;,]/g)
i.exec(e)&&(t++,e.match(i).forEach(r))}}),t>0?n:null}function c(e,r){function n(e,r){var n=""
if(e.face_rule){var t=null,c=Number.MAX_VALUE
Object.keys(e.face_rule).forEach(function(e,n,i){var o=Number(e)
r<=o&&o-r<=c&&(c=o-r,t=o)}),n+=e.name+":",n+=t?e.face_rule[t]:r}else n+=e.name+":"+r
return n="<font color='#841a75' size='-1'>"+n+"</font>",n+=e.delimiter}for(var t="",c=0;c<r.faces.length;c++){var i={name:"d"+(c+1),delimiter:"<br> "}
String(c+1)in e&&(i=e[String(c+1)]),t+=n(i,r.faces[c])}return t}function i(e){if(!e.bloq.classList.contains("__rpg_dice_descr__")){var r=c(_rule,e)
e.bloq.innerHTML+="<br>"+r,e.bloq.classList.add("__rpg_dice_descr__")}}function o(){var e=function(e){return document.getElementById(e)},r=e("ftbl"),n=e("ufm")
"absolute"==r.style.position&&(r.style.top=n.offsetTop+"px")}function a(e){console.log("start rpg-dice ver"+l+" ..."),n(),u.forEach(function(e,r,n){i(e)}),o(),console.log("done")}var l="1.1",u=null
_rule=null
return a}"undefined"==typeof __rpg_dice_counter__&&(__rpg_dice_counter__=make_rpg_dice_counter()),__rpg_dice_counter__()
