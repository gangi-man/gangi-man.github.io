function make_dice_counter(){function n(n){for(;n;){if("BLOCKQUOTE"==n.tagName)return n
n=n.nextElementSibling}return null}function e(n,e,t){var i=null,o=[]
if(e.innerHTML.split(/<br>/i).forEach(function(n,e,t){n.match(/<font\s+color="#ff0000"\s*>/i)&&(i=n,n=n.replace(/<font/i,'<span class="faces"><font'),n=n.replace(/<\/font>/i,"</font></span>")),o.push(n)}),i){e.innerHTML=o.join("<br>")
var r=RegExp(/dice(\d+)d(\d+)([-+]\d+)?=/i),l=r.exec(i)
if(!l)return null
var c=l[1],u=l[2],d=0,s=""
l[3]&&(d=Number(l[3]),d<0&&(s=""+d),d>0&&(s="+"+d))
var a="dice"+c+"d"+u+s,f=/<font\s+color="#ff0000">\s*((\d+\s+)+)\((\d+)\)<\/font>/.exec(i)
if(!f)return console.log("---------something wrong ---"+n+"\n"+i),null
var g=Number(f[3]),m=f[1].replace(/\s+$/,"").split(/\s+/)
return m.forEach(function(n,e,t){t[e]=Number(n)}),{dnum:c,dmax:u,dadd:d,kind:a,id:Number(n),input:t,bloq:e,faces:m,sum:g}}}function t(n){var e=n.bloq.innerHTML
e=e.replace(/&gt;/gi,">"),e=e.replace(/<br>/gi,"\n"),e=e.replace(/<[^>]*>/g,""),console.log("id:"+n.id+" "+n.kind+" score:"+n.ginga_score+"\n"+n.ginga_arr+"\n"+e)}function i(){if(!p){var t=document.getElementsByTagName("input")
p=[]
for(var i=0;i<t.length;i++){var r=/delcheck(\d+)/.exec(t[i].getAttribute("id"))
if(r){var l=n(t[i])
if(l){var c=e(r[1],l,t[i])
c&&p.push(c)}}}p.forEach(function(n,e,t){o(n)}),p.length>0&&(h=p[0].sum)}}function o(n){function e(n){var e=0
return n.forEach(function(t,i,o){n[i]==r[i]&&e++}),n.length>=4&&"GA"==n[0]&&"NN"==n[1]&&"GA"==n[2]&&"NN"==n[3]&&(e+=4),n.length>=7&&"GI"==n[4]&&"GI"==n[5]&&"NN"==n[6]&&(e+=3),n.length>=12&&"GI"==n[7]&&"NN"==n[8]&&"GA"==n[9]&&"MA"==n[10]&&"NN"==n[11]&&(e+=5),e}function t(n){var e=""
return n.forEach(function(t,i,l){e+=n[i]==r[i]?'<font color="#191970">'+o[n[i]]+"</font> ":'<font color="#4682b4">'+o[n[i]]+"</font> "}),e}if(!n.ginga_html){for(var i=["GA","NN","GI","MA","**"],o={GA:"&#12460;",NN:"&#12531;",GI:"&#12462;",MA:"&#12510;","**":"&#65290;"},r=["GA","NN","GA","NN","GI","GI","NN","GI","NN","GA","MA","NN"],l=0,c=[],u=[],d={},s=n.sum;s>0;)c=[s%10].concat(c),s=Math.floor(s/10)
c=n.faces.concat(c),c.forEach(function(n,e,t){n in d||(d[n]=i[l],l<4&&l++),u.push(d[n])}),n.ginga_html=t(u),n.ginga_score=e(u)}}function r(n){if(!y){var e=document.getElementById("_ginga_frame_")
e&&document.body.removeChild(e)
var t=y=document.createElement("IFRAME")
t.MaxHeight=Math.floor(.8*window.innerHeight),t.setAttribute("id","_ginga_frame_"),t.style.position="fixed",t.style.top="0px",t.style.right="0px",t.style.width="380px",t.style.height=t.MaxHeight+"px",t.style.backgroundColor="#e9dfe5",document.body.appendChild(t),setTimeout(function(){l(),d(),c(),u(p,b["no-"])},500)}}function l(){function n(n){o?(y.style.height=v.clientHeight+"px",N.hide()):y.style.height=y.MaxHeight+"px",o=!o}function e(n){m("toggle_descr")}function t(n,e){var t=_.getElementById("enableGinga")
"gng+"!=n&&"gng-"!=n||t.checked||(t.checked=!0,m("toggle_descr")),r=n,u(p,b[n])}function i(n){h=Number(_.getElementById("input_ginga").value),u(p,b[r])}if(!v){var o=!0,r=null
_=document.getElementById("_ginga_frame_").contentDocument
var l=v=_.createElement("DIV")
l.innerHTML+="<button id='sortNoBtn_'>&#26032;&#38918;</button>",l.innerHTML+="<button id='sortNoBtn'>&#21476;&#38918;</button>",l.innerHTML+="<button id='sortSumBtn'>&#22810;&#38918;</button>",l.innerHTML+="<button id='sortSumBtn_'>&#23569;&#38918;</button>",l.innerHTML+="<button id='sortGngBtn'>&#12462;&#38918;+</button>",l.innerHTML+="<button id='sortGngBtn_'>&#12462;&#38918;-</button>",l.innerHTML+="<input id='enableGinga' type='checkbox'>",l.innerHTML+="<input id='input_ginga' size='8' value='"+h+"'/>",l.innerHTML+="<button id='opclBtn'>open/close</button>",l.style.position="fixed",l.style.top="0px",_.body.appendChild(l),_.getElementById("sortNoBtn").addEventListener("click",t.bind(null,"no+")),_.getElementById("sortNoBtn_").addEventListener("click",t.bind(null,"no-")),_.getElementById("sortSumBtn").addEventListener("click",t.bind(null,"sum+")),_.getElementById("sortSumBtn_").addEventListener("click",t.bind(null,"sum-")),_.getElementById("sortGngBtn").addEventListener("click",t.bind(null,"gng+")),_.getElementById("sortGngBtn_").addEventListener("click",t.bind(null,"gng-")),_.getElementById("enableGinga").addEventListener("change",e),_.getElementById("opclBtn").addEventListener("click",n),_.getElementById("input_ginga").addEventListener("input",i)}}function c(){if(E)for(;E.firstChild;)E.removeChild(E.firstChild)
else{var n=_,e=E=n.createElement("DIV")
e.style.position="fixed",e.style.overflow="scroll",e.style.top=v.clientHeight+"px",e.style.width="95%",e.style.height=y.MaxHeight-v.clientHeight+"px",_.body.appendChild(e)}}function u(n,e){function t(n){var e=n.input.getBoundingClientRect().top+window.pageYOffset
window.scrollTo(0,e)}function i(n){N.update(n.target.dice.bloq.innerHTML)}c(),n=n.sort(e),n.forEach(function(n,e,o){var r=_.createElement("DIV")
r.innerHTML="id:"+n.id+" "+n.kind+" sum:"+n.sum+" GP:"+n.ginga_score,r.addEventListener("click",t.bind(null,n)),r.dice=n,r.addEventListener("mouseover",i),n.sum<h?r.style.backgroundColor="#8989ff":n.sum==h?r.style.backgroundColor="#89ffc4":r.style.backgroundColor="#ff8989",E.appendChild(r)})}function d(){N||(N=document.createElement("span"),N.style.position="fixed",N.style.bottom="0px",N.style.right="0px",N.style.backgroundColor="#f5deb3",N.style.display="none",N.innerHTML="",N.update=function(n){N.style.display="",N.innerHTML=n},N.hide=function(){N.style.display="none"},setTimeout(function(){document.body.appendChild(N)},500))}function s(n){var e=""
n.bloq.innerHTML.split(/<br>/i).forEach(function(t,i,o){e+=t,t.match(/<font\s+color/i)&&t.match(/"#ff0000"/i)&&(e+='<span class="ginga_descr">',e+='<br><span style="visibility:hidden;">'+n.kind+"=</span>",e+='<span class="faces">'+n.ginga_html+"</span>",e+=' <font color="#4b0082">(GP:'+n.ginga_score+")</font></span>"),e+="<br>"}),n.bloq.innerHTML=e
var t=n.bloq.getElementsByClassName("faces")
if(!B){var i=Math.floor(100*t[0].offsetWidth/t[1].offsetWidth)
i<20&&(i=20),B=i+"%"}t[1].style.fontSize=B}function a(){var n=document.getElementById("ftbl"),e=document.getElementById("ufm")
"absolute"==n.style.position&&(n.style.top=e.offsetTop+"px")}function f(n){for(var e=document.getElementsByClassName("ginga_descr"),t=0;t<e.length;t++)e[t].style.display=n?"none":""
a()}function g(){p.forEach(function(n,e,i){t(n)})}function m(n){"init"==n?(p=null,i(),r(),p.forEach(function(n,e,t){s(n)}),f(L)):"cls"==n?u(p):"toggle_descr"==n?(L=!L,f(L)):"dump"==n?g():console.log("DISPATCH ERROR"+n)}var p=null,h=0,b={"no+":function(n,e){return e.id-n.id},"no-":function(n,e){return n.id-e.id},"sum+":function(n,e){return e.sum-n.sum},"sum-":function(n,e){return n.sum-e.sum},"gng+":function(n,e){return e.ginga_score-n.ginga_score},"gng-":function(n,e){return n.ginga_score-e.ginga_score}},y=null,_=null,E=null,v=null,N=null,B=null,L=!0
return m}"undefined"==typeof __dice_counter__&&(__dice_counter__=make_dice_counter(),__dice_counter__("init"))
